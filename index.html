<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Trifusion Technologies ‚Äî Cat√°logo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
    --bg:#0b0f19;
    --card:#101624;
    --card-border:#1f2940;
    --accent:#00c2ff;
    --accent-soft:rgba(0,194,255,0.15);
    --text:#e6ecff;
    --muted:#9aa4c6;
    --danger:#ff4b6a;
}

body{
    margin:0;
    font-family:system-ui,Arial,sans-serif;
    background:radial-gradient(circle at top,#172239,#02030a);
    color:var(--text);
}

header{
    position:sticky;
    top:0;
    z-index:50;
    background:rgba(0,0,0,0.6);
    backdrop-filter:blur(10px);
    border-bottom:1px solid rgba(255,255,255,0.05);
    padding:18px 16px;
}

.header-inner{
    max-width:1100px;
    margin:auto;
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.header-inner h1{
    margin:0;
    font-size:22px;
}

.header-contact{
    font-size:12px;
    color:var(--muted);
    text-align:right;
}

.toolbar{
    max-width:1100px;
    margin:18px auto 0;
    padding:0 16px;
    display:grid;
    grid-template-columns:2fr 1fr;
    gap:12px;
}

@media(max-width:800px){
    .toolbar{grid-template-columns:1fr;}
}

.panel{
    background:rgba(8,12,26,0.9);
    border:1px solid rgba(255,255,255,0.05);
    border-radius:14px;
    padding:10px;
}

.panel-title{
    font-size:12px;
    color:var(--muted);
    letter-spacing:.12em;
    margin-bottom:6px;
}

input{
    width:100%;
    padding:8px 10px;
    border-radius:10px;
    background:#050815;
    border:1px solid rgba(255,255,255,0.08);
    color:var(--text);
    outline:none;
}

button{
    border:none;
    border-radius:10px;
    padding:8px 16px;
    font-weight:600;
    cursor:pointer;
    background:linear-gradient(135deg,var(--accent),#5de0ff);
    color:#02030a;
    box-shadow:0 6px 18px rgba(0,194,255,0.35);
}

.catalogo-wrapper{
    max-width:1100px;
    margin:20px auto 40px;
    padding:0 16px;
}

.catalogo{
    display:flex;
    flex-direction:column;
    gap:12px;
}

.categoria{
    margin:26px 0 10px;
    padding:12px 16px;
    background:linear-gradient(135deg,rgba(0,194,255,.35),rgba(0,194,255,.1));
    border-left:5px solid var(--accent);
    border-radius:12px;
    font-weight:800;
    letter-spacing:.14em;
    text-transform:uppercase;
    color:var(--accent);
}

.producto{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:14px;
    padding:14px;
    display:flex;
    justify-content:space-between;
    gap:14px;
    box-shadow:0 14px 30px rgba(0,0,0,0.35);
}

.descripcion{
    color:var(--accent);
    font-weight:600;
    flex:1;
}

.producto-right{
    text-align:right;
    min-width:150px;
}

.precio{
    font-size:20px;
    font-weight:700;
    color:var(--danger);
}

.precio.transito{
    color:#ffc14b;
    text-shadow:0 0 6px rgba(255,193,75,.45);
}

.editor-precio{
    margin-top:6px;
    display:flex;
    gap:6px;
}

.editor-precio input{
    width:90px;
}

#mensajeVacio{
    text-align:center;
    color:var(--muted);
    margin-top:20px;
}
</style>
</head>

<body>

<header>
    <div class="header-inner">
        <h1>Trifusion Technologies</h1>
        <div class="header-contact">
            üìç Santo Domingo<br>
            WhatsApp: +1 (829) 872-5163
        </div>
    </div>
</header>

<div class="toolbar">
    <div class="panel">
        <div class="panel-title">Buscar art√≠culos</div>
        <input id="buscadorProductos" placeholder="Buscar producto‚Ä¶">
    </div>

    <div class="panel">
        <div class="panel-title">Acceso</div>
        <button id="btnLogin">Entrar</button>
        <button id="btnLogout" style="display:none;">Salir</button>
    </div>
</div>

<div class="catalogo-wrapper">
    <div id="catalogo" class="catalogo"></div>
    <div id="mensajeVacio" style="display:none;">No se encontraron productos.</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
const ADMIN_USER = "TELEFONO";
const ADMIN_PASS = "1234";
const SHEET_ID = "1EtOwxNRGq0WFgGaRXtJgibUqzxIgcAUeRkJlr1wPsLc";
const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;

const CATEGORIA_REGEX = /^[A-Z0-9\- \/]+$/;

let productos = [];
let esAdmin = false;

function formatearPrecio(n){
    return "$" + n.toLocaleString("es-DO");
}

function cargarLista(data){
    productos = [];

    data.forEach(fila=>{
        const desc = (fila[2]||"").trim();
        const precio = (fila[3]||"").trim();

        if(!desc) return;

        if(!precio && CATEGORIA_REGEX.test(desc)){
            productos.push({tipo:"categoria", descripcion:desc});
            return;
        }

        let esTransito = precio.toUpperCase().includes("TRANSITO");
        let base = esTransito ? null : parseFloat(precio.replace(/\D/g,"")) || null;

        productos.push({
            tipo:"producto",
            descripcion:desc,
            basePrecio:base,
            esTransito
        });
    });
}

function renderProductos(filtro=""){
    const cont = document.getElementById("catalogo");
    const vacio = document.getElementById("mensajeVacio");
    cont.innerHTML = "";

    const f = filtro.toLowerCase();
    const lista = productos.filter(p=>!f || p.descripcion.toLowerCase().includes(f));

    vacio.style.display = lista.length ? "none" : "block";

    lista.forEach((p,idx)=>{
        if(p.tipo==="categoria"){
            const d=document.createElement("div");
            d.className="categoria";
            d.textContent=p.descripcion;
            cont.appendChild(d);
            return;
        }

        let texto = p.esTransito ? "TR√ÅNSITO" :
                    p.basePrecio ? formatearPrecio(Math.round(p.basePrecio*1.20)) :
                    "SIN PRECIO";

        let clase = p.esTransito || !p.basePrecio ? "transito" : "";

        const card=document.createElement("div");
        card.className="producto";
        card.innerHTML=`
            <div class="descripcion">${p.descripcion}</div>
            <div class="producto-right">
                <div class="precio ${clase}">${texto}</div>
                ${esAdmin && !p.esTransito ? `
                <div class="editor-precio">
                    <input type="number" value="${p.basePrecio||""}" data-idx="${idx}">
                    <button class="btn-aplicar" data-idx="${idx}">OK</button>
                </div>` : ""}
            </div>`;
        cont.appendChild(card);
    });
}

async function cargarCatalogo(){
    const r=await fetch(CSV_URL);
    const t=await r.text();
    Papa.parse(t,{complete:r=>{
        cargarLista(r.data);
        renderProductos();
    }});
}

document.getElementById("buscadorProductos")
.addEventListener("input",e=>renderProductos(e.target.value));

document.getElementById("btnLogin").onclick=()=>{
    const u=prompt("Usuario");
    const p=prompt("Contrase√±a");
    if(u===ADMIN_USER && p===ADMIN_PASS){
        esAdmin=true;
        btnLogout.style.display="inline-block";
        alert("Modo edici√≥n activado");
        renderProductos(buscadorProductos.value);
    }
};

document.getElementById("btnLogout").onclick=()=>{
    esAdmin=false;
    btnLogout.style.display="none";
    renderProductos(buscadorProductos.value);
};

document.getElementById("catalogo").addEventListener("click",e=>{
    if(e.target.classList.contains("btn-aplicar")){
        const i=e.target.dataset.idx;
        const v=parseFloat(e.target.previousElementSibling.value);
        if(v){
            productos[i].basePrecio=v;
            renderProductos(buscadorProductos.value);
        }
    }
});

cargarCatalogo();
</script>

</body>
</html>

