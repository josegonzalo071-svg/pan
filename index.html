<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Phone Product Management | Trifusion Technologies</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg: #0b0f19;
            --card: #101624;
            --card-border: #1f2940;
            --accent: #00c2ff;
            --accent-soft: rgba(0,194,255,0.18);
            --text: #e6ecff;
            --muted: #9aa4c6;
            --danger: #ff4b6a;
            --success: #16a34a;
        }
        
        body {
            font-family: system-ui, Arial, sans-serif;
            background: radial-gradient(circle at top, #172239 0, #050712 55%, #02030a 100%);
            margin: 0;
            color: var(--text);
            min-height: 100vh;
        }
        
        header {
            padding: 18px 16px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 50;
        }
        
        .header-inner {
            max-width: 1100px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-title h1 {
            margin: 0;
            font-size: 22px;
            letter-spacing: 0.03em;
        }
        
        .header-contact {
            font-size: 12px;
            color: var(--muted);
            text-align: right;
        }
        
        /* Toolbar */
        .toolbar {
            max-width: 1100px;
            margin: 18px auto 0;
            padding: 0 16px 4px;
            display: grid;
            grid-template-columns: minmax(0, 2fr) minmax(0, 1fr);
            gap: 12px;
        }
        
        @media (max-width: 800px) {
            .toolbar {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: rgba(8, 12, 26, 0.9);
            border-radius: 14px;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .panel-title {
            font-size: 13px;
            margin-bottom: 6px;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        
        input[type="text"], input[type="number"] {
            width: 100%;
            background: #050815;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 8px 10px;
            color: var(--text);
            font-size: 14px;
            outline: none;
        }
        
        button {
            border: none;
            border-radius: 10px;
            padding: 8px 15px;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 0.03em;
            cursor: pointer;
            background: linear-gradient(135deg, var(--accent), #62e3ff);
            color: #02030a;
            box-shadow: 0 6px 18px rgba(0, 194, 255, 0.35);
            white-space: nowrap;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #ff385c);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #155e35);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--accent);
            color: var(--accent);
        }
        
        .btn-outline:hover {
            background: rgba(0, 194, 255, 0.1);
        }
        
        .category-header {
            background: linear-gradient(to right, #1a2640, #0e1829);
            border-radius: 10px;
            padding: 14px;
            margin: 24px 0 16px;
            border-left: 4px solid var(--accent);
        }
        
        .category-header h2 {
            margin: 0;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .category-header h2 i {
            color: var(--accent);
        }
        
        /* Product list */
        .product-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .product-card {
            background: var(--card);
            border-radius: 14px;
            padding: 14px;
            border: 1px solid var(--card-border);
            box-shadow: 0 14px 30px rgba(0, 0, 0, 0.35);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: contain;
            background: #050815;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .product-info {
            flex: 1;
        }
        
        .product-title {
            font-size: 1.2rem;
            margin: 0 0 8px;
            color: var(--accent);
            font-weight: 600;
        }
        
        .product-desc {
            font-size: 0.9rem;
            color: var(--muted);
            margin-bottom: 12px;
            line-height: 1.4;
        }
        
        .product-price {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 15px;
            white-space: nowrap;
        }
        
        .product-actions {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }
        
        /* Product form */
        .form-container {
            max-width: 800px;
            margin: 30px auto;
            padding: 20px;
            background: var(--card);
            border-radius: 14px;
            border: 1px solid var(--card-border);
        }
        
        .form-title {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.8rem;
            color: var(--accent);
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            flex: 1;
            min-width: 250px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--muted);
        }
        
        .image-upload {
            border: 2px dashed #444;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            background: rgba(0, 0, 0, 0.2);
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .image-upload:hover {
            background: rgba(0, 194, 255, 0.1);
            border-color: var(--accent);
        }
        
        .image-preview {
            max-height: 200px;
            margin-top: 15px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .image-preview img {
            width: 100%;
            height: auto;
        }
        
        .category-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }
        
        .category-option {
            background: rgba(0, 194, 255, 0.1);
            border: 1px solid var(--card-border);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .category-option:hover {
            background: rgba(0, 194, 255, 0.2);
            transform: translateY(-3px);
        }
        
        .category-option.selected {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        
        .category-option i {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }
        
        .category-option h4 {
            margin: 0;
            font-size: 1.1rem;
        }
        
        .category-option p {
            font-size: 0.9rem;
            margin: 5px 0 0;
            opacity: 0.8;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--muted);
        }
        
        .empty-state i {
            font-size: 4rem;
            opacity: 0.3;
            margin-bottom: 20px;
        }
        
        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom:0px;
        }
        
        .tab-navigation {
            display: flex;
            border-bottom: 1px solid var(--card-border);
            margin-bottom: 20px;
        }
        
        .tab-btn {
            padding: 12px 20px;
            background: transparent;
            border: none;
            color: var(--muted);
            font-size: 1.1rem;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            color: var(--accent);
            font-weight: 600;
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--accent);
            border-radius: 3px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .product-features {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .feature-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 12px;
            border-radius: 8px;
        }
        
        .feature-item h5 {
            margin: 0 0 8px;
            font-size: 1.1rem;
            color: var(--accent);
        }
        
        .feature-value {
            font-size: 0.95rem;
            color: var(--muted);
        }
        
        .category-filter {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .category-filter-btn {
            background: rgba(0, 194, 255, 0.1);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 6px 15px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .category-filter-btn.active {
            background: var(--accent);
            color: white;
        }
        
        .category-filter-btn:hover {
            background: rgba(0, 194, 255, 0.2);
        }
        
        /* Toast notification */
        #toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--card);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            transform: translateY(100%);
            transition: transform 0.3s;
            max-width: 400px;
        }
        
        #toast.show {
            transform: translateY(0);
        }
        
        .toast-success {
            border-left: 4px solid var(--success);
        }
        
        .toast-error {
            border-left: 4px solid var(--danger);
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .product-list {
                grid-template-columns: 1fr;
            }
            
            .toolbar {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .category-selector {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-inner">
            <div class="logo-title">
                <h1>Trifusion Technologies</h1>
            </div>
            <div class="header-contact">
                <div>üìç Santo Domingo</div>
                <div>WhatsApp: +1 (829) 872-5163</div>
            </div>
        </div>
    </header>
    
    <!-- Toolbar -->
    <div class="toolbar">
        <!-- Category Filter -->
        <div class="panel">
            <div class="panel-title">Filtrar por categor√≠a</div>
            <div class="category-filter" id="categoryFilter">
                <button class="category-filter-btn active" data-category="all">Todas las categor√≠as</button>
            </div>
        </div>
        
        <!-- Add Product Button -->
        <div class="panel">
            <div class="panel-title">Acciones</div>
            <button id="addProductBtn" class="btn btn-block w-100">
                <i class="fas fa-plus-circle me-2"></i>Agregar nuevo producto
            </button>
        </div>
    </div>
    
    <!-- Main Content -->
    <main class="container">
        <!-- Category Navigation Tabs -->
        <div class="tab-navigation">
            <button class="tab-btn active" data-tab="products">Productos</button>
            <button class="tab-btn" data-tab="categories">Categor√≠as</button>
            <button class="tab-btn" data-tab="settings">Configuraci√≥n</button>
        </div>
        
        <!-- Tab Content -->
        <div id="productsTab" class="tab-content active">
            <div class="category-header">
                <h2><i class="fas fa-mobile-alt"></i> Productos de Tel√©fonos</h2>
                <p>Administre los productos de tel√©fonos desde su inventario</p>
            </div>
            
            <!-- Product List -->
            <div class="product-list" id="productList">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
        
        <div id="categoriesTab" class="tab-content">
            <div class="category-header">
                <h2><i class="fas fa-th-large"></i> Categor√≠as de Tel√©fonos</h2>
                <p>Administre las categor√≠as de los productos de tel√©fonos</p>
            </div>
            
            <div class="category-selector" id="categorySelector">
                <!-- Categories will be populated here -->
            </div>
            
            <div class="form-container" id="categoryForm" style="display: none;">
                <h2 class="form-title">Editar Categor√≠a</h2>
                <div class="form-group">
                    <label for="categoryName">Nombre de la Categor√≠a</label>
                    <input type="text" id="categoryName" class="form-control" placeholder="Ej: TCL, ZTE, CUBOT">
                </div>
                <div class="form-group">
                    <label for="categoryDescription">Descripci√≥n</label>
                    <textarea id="categoryDescription" class="form-control" rows="3" placeholder="Descripci√≥n de la categor√≠a"></textarea>
                </div>
                <div class="form-group">
                    <label for="categoryColor">Color de la Categor√≠a</label>
                    <input type="color" id="categoryColor" class="form-control" value="#00c2ff">
                </div>
                <div class="d-flex justify-content-end mt-4">
                    <button id="cancelCategoryBtn" class="btn btn-outline me-2">Cancelar</button>
                    <button id="saveCategoryBtn" class="btn btn-success">Guardar</button>
                </div>
            </div>
        </div>
        
        <div id="settingsTab" class="tab-content">
            <div class="category-header">
                <h2><i class="fas fa-cog"></i> Configuraci√≥n de Productos</h2>
                <p>Configuraci√≥n avanzada para productos de tel√©fonos</p>
            </div>
            
            <div class="form-container">
                <h2 class="form-title">Opciones de Productos</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="defaultCategory">Categor√≠a Predeterminada</label>
                        <select id="defaultCategory" class="form-select">
                            <option value="">Seleccione una categor√≠a</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="productTemplate">Plantilla de Productos</label>
                        <select id="productTemplate" class="form-select">
                            <option value="default">Plantilla B√°sica</option>
                            <option value="detailed">Plantilla Detallada</option>
                            <option value="premium">Plantilla Premium</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="imageQuality">Calidad de Im√°genes</label>
                        <select id="imageQuality" class="form-select">
                            <option value="high">Alta (1080px)</option>
                            <option value="medium" selected>Media (720px)</option>
                            <option value="low">Baja (480px)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="autoSave">Auto-Guardado</label>
                        <select id="autoSave" class="form-select">
                            <option value="true">Habilitado</option>
                            <option value="false">Deshabilitado</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="priceFormat">Formato de Precios</label>
                        <select id="priceFormat" class="form-select">
                            <option value="local">Local (RD$ 1,234.56)</option>
                            <option value="international" selected>Internacional ($1,234.56)</option>
                        </select>
                    </div>
                </div>
                
                <div class="d-flex justify-content-end mt-4">
                    <button class="btn btn-success">Guardar Configuraci√≥n</button>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Product Form Modal -->
    <div class="modal fade" id="productModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="background: var(--card); border: 1px solid var(--card-border);">
                <div class="modal-header">
                    <h5 class="modal-title" id="productModalTitle">Nuevo Producto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-container">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="productName">Nombre del Producto</label>
                                <input type="text" id="productName" class="form-control" placeholder="Ej: TCL 502 (128GB, 6.52", 12GB RAM 4+8)">
                            </div>
                            <div class="form-group">
                                <label for="productModel">Modelo</label>
                                <input type="text" id="productModel" class="form-control" placeholder="Ej: TCL 502">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="productPrice">Precio (RD$)</label>
                                <input type="number" id="productPrice" class="form-control" min="0" step="0.01" placeholder="1,999.00">
                            </div>
                            <div class="form-group">
                                <label for="productStock">Stock</label>
                                <input type="number" id="productStock" class="form-control" min="0" value="0">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="productDescription">Descripci√≥n</label>
                            <textarea id="productDescription" class="form-control" rows="3" placeholder="Descripci√≥n detallada del producto"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="productCategory">Categor√≠a</label>
                            <select id="productCategory" class="form-select">
                                <option value="">Seleccione una categor√≠a</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Caracter√≠sticas Principales</label>
                            <div id="productFeatures" class="product-features">
                                <!-- Features will be added here -->
                            </div>
                            <button id="addFeatureBtn" class="btn btn-outline mt-2">
                                <i class="fas fa-plus me-2"></i>Agregar Caracter√≠stica
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <label>Im√°genes del Producto</label>
                            <div class="image-upload" id="imageUpload">
                                <i class="fas fa-cloud-upload-alt fa-3x mb-2"></i>
                                <p>Arrastra y suelta im√°genes aqu√≠ o haz clic para seleccionar</p>
                                <input type="file" id="imageInput" accept="image/*" multiple style="display: none;">
                            </div>
                            <div class="image-preview" id="imagePreview">
                                <!-- Image previews will appear here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" id="saveProductBtn" class="btn btn-success">Guardar Producto</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast" class="toast-success">
        <i class="fas fa-check-circle me-2"></i>
        <span id="toastMessage">Operaci√≥n exitosa</span>
    </div>
    
    <!-- Firebase Config -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <script>
        // Firebase configuration - using your provided config
        const firebaseConfig = {
            apiKey: "AIzaSyDlOJqBgd-8KqUT-Y94lsma5W8T79PsPjM",
            authDomain: "trifusion-cotizador.firebaseapp.com",
            projectId: "trifusion-cotizador",
            storageBucket: "trifusion-cotizador.firebasestorage.app",
            messagingSenderId: "407374211882",
            appId: "1:407374211882:web:b692792ccc39c8d48f4c53"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
        
        // Global variables
        let products = [];
        let categories = [];
        let currentEditProduct = null;
        let imageFiles = [];
        let imagePreviews = [];
        
        // DOM Elements
        const productList = document.getElementById('productList');
        const categoryFilter = document.getElementById('categoryFilter');
        const addProductBtn = document.getElementById('addProductBtn');
        const productModal = document.getElementById('productModal');
        const productModalTitle = document.getElementById('productModalTitle');
        const saveProductBtn = document.getElementById('saveProductBtn');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Firebase
            initFirebase();
            
            // Load data from Google Sheets
            loadProductsFromSheets();
            
            // Set up event listeners
            setupEventListeners();
            
            // Set up tab navigation
            setupTabs();
        });
        
        function initFirebase() {
            // Firebase is already initialized via the config
            console.log('Firebase initialized');
        }
        
        function setupEventListeners() {
            // Add product button
            addProductBtn.addEventListener('click', () => {
                resetProductForm();
                productModalTitle.textContent = 'Nuevo Producto';
                productModal.style.display = 'block';
                $('#productModal').modal('show');
            });
            
            // Save product button
            saveProductBtn.addEventListener('click', saveProduct);
            
            // Image upload
            document.getElementById('imageUpload').addEventListener('click', () => {
                document.getElementById('imageInput').click();
            });
            
            document.getElementById('imageInput').addEventListener('change', handleImageUpload);
            
            // Add feature button
            document.getElementById('addFeatureBtn').addEventListener('click', addFeatureField);
        }
        
        function setupTabs() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // Update active tab
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Show active tab content
                    const tabId = btn.getAttribute('data-tab');
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabId}Tab`).classList.add('active');
                });
            });
        }
        
        function loadProductsFromSheets() {
            // Using your Google Sheets URL
            const SHEET_ID = "1EtOwxNRGq0WFgGaRXtJgibUqzxIgcAUeRkJlr1wPsLc";
            const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;
            
            fetch(CSV_URL)
                .then(response => response.text())
                .then(csv => {
                    // Parse CSV data
                    const lines = csv.split('\n');
                    const headers = lines[0].split(',');
                    
                    // Process each row
                    for (let i = 1; i < lines.length; i++) {
                        if (lines[i].trim() === '') continue;
                        
                        const values = lines[i].split(',');
                        const product = {};
                        
                        // Map headers to values
                        headers.forEach((header, index) => {
                            // Clean up header name
                            const cleanHeader = header.trim().toLowerCase().replace(/[^a-z0-9]/g, '');
                            product[cleanHeader] = values[index] ? values[index].trim() : '';
                        });
                        
                        // Only process phone products (skip if not phone category)
                        if (product['clase'] && product['clase'].trim() !== '') {
                            // Check if this is a category row (blue row)
                            if (product['modelo'] === '' && product['precio'] === '') {
                                // This is a category row
                                categories.push({
                                    id: product['clase'].toLowerCase().replace(/[^a-z0-9]/g, ''),
                                    name: product['clase'].trim(),
                                    description: '',
                                    color: '#00c2ff'
                                });
                            } else {
                                // This is a product row
                                products.push({
                                    id: `product-${Date.now()}-${Math.floor(Math.random() * 1000)}`,
                                    name: product['modelo'].trim(),
                                    model: product['modelo'].trim(),
                                    price: parseFloat(product['precio'].replace(/[^0-9.]/g, '')) || 0,
                                    description: '',
                                    category: product['clase'].trim().toLowerCase().replace(/[^a-z0-9]/g, ''),
                                    features: [
                                        { name: 'Memoria', value: product['memoria'] || '' },
                                        { name: 'Pantalla', value: product['pantalla'] || '' },
                                        { name: 'C√°mara', value: product['camara'] || '' },
                                        { name: 'Procesador', value: product['procesador'] || '' },
                                        { name: 'Bater√≠a', value: product['bateria'] || '' }
                                    ],
                                    images: [],
                                    stock: 0
                                });
                            }
                        }
                    }
                    
                    // After loading data, render products
                    renderProducts();
                    renderCategories();
                    renderCategoryFilter();
                    
                    // Hide loading spinner
                    setTimeout(() => {
                        document.querySelector('.loading').style.display = 'none';
                    }, 500);
                })
                .catch(error => {
                    console.error('Error loading products:', error);
                    showNotification('Error al cargar los productos', 'error');
                    // Show empty state
                    productList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-exclamation-circle"></i>
                            <h3>Error al cargar los productos</h3>
                            <p>No se pudieron cargar los productos desde Google Sheets. Verifique la conexi√≥n.</p>
                            <button class="btn btn-outline" onclick="loadProductsFromSheets()">Reintentar</button>
                        </div>
                    `;
                });
        }
        
        function renderProducts() {
            if (products.length === 0) {
                productList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-mobile-alt"></i>
                        <h3>No hay productos de tel√©fonos</h3>
                        <p>Comience agregando nuevos productos de tel√©fonos para empezar.</p>
                        <button class="btn btn-success" onclick="document.getElementById('addProductBtn').click()">
                            <i class="fas fa-plus-circle me-2"></i>Agregar Nuevo Producto
                        </button>
                    </div>
                `;
                return;
            }
            
            // Filter products by active category
            const activeCategory = document.querySelector('.category-filter-btn.active')?.dataset.category || 'all';
            let filteredProducts = products;
            
            if (activeCategory !== 'all') {
                filteredProducts = products.filter(p => p.category === activeCategory);
            }
            
            // Render products
            productList.innerHTML = '';
            filteredProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <div class="product-image">
                        ${product.images.length > 0 ? 
                            `<img src="${product.images[0]}" alt="${product.name}">` : 
                            '<i class="fas fa-mobile-alt fa-3x opacity-50"></i>'
                        }
                    </div>
                    <div class="product-info">
                        <h3 class="product-title">${product.name}</h3>
                        <p class="product-desc">${product.description || 'Producto de tel√©fono'}</p>
                        <div class="product-price">RD$ ${formatPrice(product.price)}</div>
                        <div class="product-actions">
                            <button class="btn btn-outline btn-sm" onclick="editProduct('${product.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteProduct('${product.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                productList.appendChild(productCard);
            });
        }
        
        function renderCategories() {
            const categorySelector = document.getElementById('categorySelector');
            categorySelector.innerHTML = '';
            
            categories.forEach(category => {
                const categoryElement = document.createElement('div');
                categoryElement.className = 'category-option';
                categoryElement.innerHTML = `
                    <i class="fas fa-mobile-alt"></i>
                    <h4>${category.name}</h4>
                    <p>${category.description || 'Categor√≠a de tel√©fonos'}</p>
                `;
                categoryElement.addEventListener('click', () => {
                    // Select this category
                    document.querySelectorAll('.category-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    categoryElement.classList.add('selected');
                    
                    // Show category form
                    document.getElementById('categoryForm').style.display = 'block';
                    
                    // Populate form
                    document.getElementById('categoryName').value = category.name;
                    document.getElementById('categoryDescription').value = category.description;
                    document.getElementById('categoryColor').value = category.color;
                });
                categorySelector.appendChild(categoryElement);
            });
        }
        
        function renderCategoryFilter() {
            const categoryFilter = document.getElementById('categoryFilter');
            categoryFilter.innerHTML = '';
            
            // Add "All Categories" button
            const allBtn = document.createElement('button');
            allBtn.className = 'category-filter-btn active';
            allBtn.dataset.category = 'all';
            allBtn.innerHTML = '<i class="fas fa-th-large me-1"></i> Todas las categor√≠as';
            allBtn.addEventListener('click', () => {
                document.querySelectorAll('.category-filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                allBtn.classList.add('active');
                renderProducts();
            });
            categoryFilter.appendChild(allBtn);
            
            // Add category filter buttons
            categories.forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-filter-btn';
                btn.dataset.category = category.id;
                btn.innerHTML = `<i class="fas fa-mobile-alt me-1"></i> ${category.name}`;
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.category-filter-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    btn.classList.add('active');
                    renderProducts();
                });
                categoryFilter.appendChild(btn);
            });
        }
        
        function resetProductForm() {
            document.getElementById('productName').value = '';
            document.getElementById('productModel').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productDescription').value = '';
            document.getElementById('productCategory').value = '';
            document.getElementById('productStock').value = '0';
            imageFiles = [];
            imagePreviews = [];
            document.getElementById('imagePreview').innerHTML = '';
            
            // Clear features
            const featuresContainer = document.getElementById('productFeatures');
            featuresContainer.innerHTML = '';
            
            // Add default features
            addFeatureField({ name: 'Memoria', value: '' });
            addFeatureField({ name: 'Pantalla', value: '' });
            addFeatureField({ name: 'C√°mara', value: '' });
            addFeatureField({ name: 'Procesador', value: '' });
            addFeatureField({ name: 'Bater√≠a', value: '' });
        }
        
        function addFeatureField(feature = { name: '', value: '' }) {
            const featuresContainer = document.getElementById('productFeatures');
            
            const featureDiv = document.createElement('div');
            featureDiv.className = 'feature-item';
            featureDiv.innerHTML = `
                <div class="form-group">
                    <label for="featureName">Nombre</label>
                    <input type="text" class="form-control feature-name" 
                           value="${feature.name}" placeholder="Ej: Memoria">
                </div>
                <div class="form-group">
                    <label for="featureValue">Valor</label>
                    <input type="text" class="form-control feature-value" 
                           value="${feature.value}" placeholder="Ej: 128GB">
                </div>
                <button type="button" class="btn btn-danger btn-sm mt-2 delete-feature">
                    <i class="fas fa-trash"></i> Eliminar
                </button>
            `;
            
            featuresContainer.appendChild(featureDiv);
            
            // Add event listener to delete button
            const deleteBtn = featureDiv.querySelector('.delete-feature');
            deleteBtn.addEventListener('click', () => {
                featuresContainer.removeChild(featureDiv);
            });
        }
        
        function handleImageUpload(event) {
            const files = event.target.files;
            if (!files || files.length === 0) return;
            
            // Clear existing previews
            imagePreviews = [];
            document.getElementById('imagePreview').innerHTML = '';
            
            // Process each file
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (!file.type.match('image.*')) continue;
                
                // Add to files array
                imageFiles.push(file);
                
                // Create preview
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.maxWidth = '100%';
                    img.style.maxHeight = '200px';
                    img.style.borderRadius = '8px';
                    img.style.margin = '10px 0';
                    
                    const previewDiv = document.createElement('div');
                    previewDiv.className = 'image-preview-item';
                    previewDiv.appendChild(img);
                    
                    document.getElementById('imagePreview').appendChild(previewDiv);
                };
                reader.readAsDataURL(file);
            }
        }
        
        function saveProduct() {
            // Get form values
            const name = document.getElementById('productName').value.trim();
            const model = document.getElementById('productModel').value.trim();
            const price = parseFloat(document.getElementById('productPrice').value) || 0;
            const description = document.getElementById('productDescription').value.trim();
            const category = document.getElementById('productCategory').value.trim();
            const stock = parseInt(document.getElementById('productStock').value) || 0;
            
            // Get features
            const features = [];
            document.querySelectorAll('.feature-item').forEach(item => {
                const name = item.querySelector('.feature-name').value.trim();
                const value = item.querySelector('.feature-value').value.trim();
                if (name) {
                    features.push({ name, value });
                }
            });
            
            if (!name || !model || !price || !category) {
                showNotification('Por favor complete los campos obligatorios', 'error');
                return;
            }
            
            // Create product object
            const product = {
                id: currentEditProduct ? currentEditProduct.id : `product-${Date.now()}-${Math.floor(Math.random() * 1000)}`,
                name,
                model,
                price,
                description,
                category,
                features,
                stock,
                images: [],
                timestamp: new Date().toISOString()
            };
            
            // If editing, find index and update
            if (currentEditProduct) {
                const index = products.findIndex(p => p.id === currentEditProduct.id);
                if (index !== -1) {
                    products[index] = product;
                }
            } else {
                // Add new product
                products.push(product);
            }
            
            // Save to Firebase (in a real app, you'd save to Firestore)
            // saveProductToFirebase(product);
            
            // Show success message
            showNotification('Producto guardado exitosamente', 'success');
            
            // Close modal
            $('#productModal').modal('hide');
            
            // Reset form
            resetProductForm();
            currentEditProduct = null;
            
            // Re-render products
            renderProducts();
            
            // Save to local storage for demo
            localStorage.setItem('phoneProducts', JSON.stringify(products));
        }
        
        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            // Set current edit product
            currentEditProduct = product;
            
            // Populate form
            document.getElementById('productName').value = product.name;
            document.getElementById('productModel').value = product.model;
            document.getElementById('productPrice').value = product.price;
            document.getElementById('productDescription').value = product.description;
            document.getElementById('productCategory').value = product.category;
            document.getElementById('productStock').value = product.stock;
            
            // Clear and populate features
            const featuresContainer = document.getElementById('productFeatures');
            featuresContainer.innerHTML = '';
            
            product.features.forEach(feature => {
                addFeatureField(feature);
            });
            
            // Set modal title
            productModalTitle.textContent = 'Editar Producto';
            
            // Show modal
            $('#productModal').modal('show');
        }
        
        function deleteProduct(productId) {
            if (!confirm('¬øEst√° seguro de que desea eliminar este producto?')) {
                return;
            }
            
            // Remove product
            products = products.filter(p => p.id !== productId);
            
            // Show notification
            showNotification('Producto eliminado exitosamente', 'success');
            
            // Re-render products
            renderProducts();
            
            // Save to local storage for demo
            localStorage.setItem('phoneProducts', JSON.stringify(products));
        }
        
        function showNotification(message, type = 'success') {
            toastMessage.textContent = message;
            toast.className = 'toast-success';
            
            if (type === 'error') {
                toast.className = 'toast-error';
            }
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        function formatPrice(price) {
            return price.toLocaleString('es-DO', { 
                style: 'currency', 
                currency: 'DOP',
                minimumFractionDigits: 2
            });
        }
        
        // Initialize category dropdown
        function initCategoryDropdown() {
            const categorySelect = document.getElementById('productCategory');
            categorySelect.innerHTML = '<option value="">Seleccione una categor√≠a</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                categorySelect.appendChild(option);
            });
        }
        
        // Initialize the app
        function initApp() {
            // Load products from local storage (if available)
            const savedProducts = localStorage.getItem('phoneProducts');
            if (savedProducts) {
                products = JSON.parse(savedProducts);
            }
            
            // Load categories from local storage
            const savedCategories = localStorage.getItem('phoneCategories');
            if (savedCategories) {
                categories = JSON.parse(savedCategories);
            } else {
                // Default categories
                categories = [
                    { id: 'tcl', name: 'TCL', description: 'Tel√©fonos TCL', color: '#00c2ff' },
                    { id: 'zte', name: 'ZTE', description: 'Tel√©fonos ZTE', color: '#16a34a' },
                    { id: 'cubot', name: 'CUBOT', description: 'Tel√©fonos CUBOT', color: '#dc2626' }
                ];
                localStorage.setItem('phoneCategories', JSON.stringify(categories));
            }
            
            // Initialize UI
            initCategoryDropdown();
            renderProducts();
            renderCategories();
            renderCategoryFilter();
        }
        
        // Call init when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
