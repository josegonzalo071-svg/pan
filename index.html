<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Trifusion Technologies ‚Äî Cat√°logo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    :root{
        --bg:#0b0f19;
        --card:#101624;
        --card-border:#1f2940;
        --accent:#00c2ff;
        --accent-soft:rgba(0,194,255,0.18);
        --text:#e6ecff;
        --muted:#9aa4c6;
        --danger:#ff4b6a;
        --success:#00c853;
    }

    body {
        font-family: system-ui, Arial, sans-serif;
        background: radial-gradient(circle at top, #172239 0, #050712 55%, #02030a 100%);
        margin: 0;
        color: var(--text);
        line-height: 1.5;
    }

    header {
        padding: 18px 16px;
        border-bottom: 1px solid rgba(255,255,255,0.05);
        background: rgba(0,0,0,0.6);
        backdrop-filter: blur(10px);
        position: sticky;
        top: 0;
        z-index: 50;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    }

    .header-inner{
        max-width: 1100px;
        margin: 0 auto;
        display:flex;
        justify-content: space-between;
        align-items:center;
        flex-wrap: wrap;
        gap: 15px;
    }

    .logo-title h1{
        margin:0;
        font-size:24px;
        letter-spacing:0.03em;
        background: linear-gradient(90deg, var(--accent), #7b3fe4, #ff4b6a);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        font-weight: 800;
    }

    .header-contact{
        font-size:13px;
        color: var(--muted);
        text-align:right;
        line-height: 1.4;
    }

    /* Toolbar */
    .toolbar{
        max-width:1100px;
        margin:18px auto 0;
        padding:0 16px 4px;
        display:grid;
        grid-template-columns:minmax(0,2fr) minmax(0,1fr);
        gap:12px;
    }

    @media(max-width:800px){
        .toolbar{
            grid-template-columns:1fr;
        }
    }

    .panel{
        background:rgba(8,12,26,0.9);
        border-radius:14px;
        padding:12px;
        border:1px solid rgba(255,255,255,0.05);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25);
    }

    .panel-title{
        font-size:13px;
        margin-bottom:8px;
        color:var(--muted);
        text-transform:uppercase;
        letter-spacing:0.1em;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .panel-title::before {
        content: "";
        display: inline-block;
        width: 4px;
        height: 14px;
        background: var(--accent);
        border-radius: 2px;
    }

    input[type="text"], input[type="number"]{
        width:100%;
        background:#050815;
        border-radius:10px;
        border:1px solid rgba(255,255,255,0.08);
        padding:10px 12px;
        color:var(--text);
        font-size:15px;
        outline:none;
        transition: border-color 0.3s;
    }
    
    input[type="text"]:focus, input[type="number"]:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 2px rgba(0, 194, 255, 0.2);
    }

    button{
        border:none;
        border-radius:10px;
        padding:10px 18px;
        font-size:15px;
        font-weight:600;
        letter-spacing:0.03em;
        cursor:pointer;
        background:linear-gradient(135deg,var(--accent),#62e3ff);
        color:#02030a;
        box-shadow:0 6px 18px rgba(0,194,255,0.35);
        white-space:nowrap;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
    }
    
    button:hover {
        transform: translateY(-1px);
        box-shadow: 0 8px 22px rgba(0,194,255,0.45);
    }
    
    button:active {
        transform: translateY(1px);
    }

    .btn-admin {
        background: linear-gradient(135deg, #ff8a00, #ff4b6a);
        box-shadow: 0 6px 18px rgba(255, 75, 106, 0.35);
    }
    
    .btn-admin:hover {
        box-shadow: 0 8px 22px rgba(255, 75, 106, 0.45);
    }

    .btn-logout {
        background: linear-gradient(135deg, #c53030, #822727);
        display: none;
        box-shadow: 0 6px 18px rgba(197, 48, 48, 0.35);
    }
    
    .btn-logout:hover {
        box-shadow: 0 8px 22px rgba(197, 48, 48, 0.45);
    }

    /* Cat√°logo */
    .catalogo-wrapper{
        max-width:1100px;
        margin:20px auto 40px;
        padding:0 16px;
    }

    .catalogo{
        display:flex;
        flex-direction:column;
        gap:12px;
    }

    .producto{
        background:var(--card);
        border-radius:14px;
        padding:16px;
        border:1px solid var(--card-border);
        box-shadow:0 14px 30px rgba(0,0,0,0.35);
        display:flex;
        justify-content:space-between;
        align-items:flex-start;
        gap:15px;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .producto::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--accent), #7b3fe4, #ff4b6a);
        opacity: 0.7;
    }
    
    .producto:hover {
        transform: translateY(-2px);
        box-shadow: 0 18px 35px rgba(0, 0, 0, 0.45);
        border-color: rgba(0, 194, 255, 0.3);
    }

    .descripcion{
        font-size:17px;
        color:var(--accent);
        font-weight:600;
        word-break:break-word;
        flex:1;
        line-height: 1.4;
    }

    .producto-right{
        display:flex;
        flex-direction:column;
        align-items:flex-end;
        min-width:170px;
        gap:8px;
    }

    .precio{
        font-size:24px;
        font-weight:800;
        white-space:nowrap;
        color:var(--danger);
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        background: linear-gradient(90deg, #ff4b6a, #ff8a00);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
    }
    
    .precio.transito{
        color:#ffc14b;
        text-shadow:0 0 6px rgba(255,193,75,0.45);
        background: none;
        color: #ffc14b;
    }

    .editor-precio{
        display:flex;
        gap:8px;
        align-items:center;
        width: 100%;
        margin-top: 4px;
    }

    .editor-precio label{
        display:none;
    }
    
    .input-precio {
        width: 100px;
        text-align: right;
        font-weight: 600;
        background: rgba(0, 30, 60, 0.7);
        border-color: var(--accent);
    }
    
    .btn-aplicar {
        background: linear-gradient(135deg, var(--success), #00aa30);
        color: white;
        padding: 6px 12px;
        font-size: 13px;
        min-width: 50px;
    }
    
    .btn-aplicar:hover {
        box-shadow: 0 6px 15px rgba(0, 200, 83, 0.4);
    }

    #mensajeVacio{
        text-align:center;
        margin-top:30px;
        color:var(--muted);
        font-size: 18px;
        padding: 30px;
        background: rgba(30, 35, 55, 0.6);
        border-radius: 16px;
        border: 1px dashed rgba(255, 255, 255, 0.1);
    }
    
    .impuesto-info {
        background: rgba(30, 40, 70, 0.7);
        border-left: 4px solid var(--accent);
        padding: 10px 15px;
        border-radius: 0 8px 8px 0;
        margin-top: 8px;
        font-size: 13px;
        color: var(--muted);
    }
    
    .impuesto-info strong {
        color: var(--accent);
    }
    
    .precio-final {
        font-size: 13px;
        color: var(--muted);
        margin-top: -4px;
        font-weight: normal;
    }
    
    @media (max-width: 768px) {
        .producto {
            flex-direction: column;
            align-items: stretch;
        }
        
        .producto-right {
            min-width: auto;
            align-items: flex-start;
        }
        
        .precio {
            font-size: 22px;
        }
        
        .descripcion {
            font-size: 16px;
        }
        
        .editor-precio {
            width: 100%;
            flex-wrap: wrap;
        }
        
        .input-precio {
            width: 120px;
        }
    }
    
    @media (max-width: 480px) {
        .header-inner {
            flex-direction: column;
            text-align: center;
        }
        
        .header-contact {
            text-align: center;
        }
        
        .toolbar {
            padding: 0 10px;
        }
        
        .panel {
            padding: 10px;
        }
        
        button {
            width: 100%;
            padding: 12px;
            font-size: 16px;
        }
        
        .precio {
            font-size: 20px;
        }
        
        .descripcion {
            font-size: 15px;
        }
    }
</style>
</head>
<body>

<header>
    <div class="header-inner">
        <div class="logo-title">
            <h1>Trifusion Technologies</h1>
        </div>
        <div class="header-contact">
            üìç Santo Domingo<br>
            WhatsApp: +1 (829) 872-5163<br>
            <span style="color: var(--accent); font-weight: 600; display: block; margin-top: 4px">‚úÖ Todos los precios incluyen impuestos</span>
        </div>
    </div>
</header>

<!-- TOOLBAR -->
<div class="toolbar">

    <!-- Buscador -->
    <div class="panel">
        <div class="panel-title">Buscar art√≠culos</div>
        <input id="buscadorProductos" type="text" placeholder="Escribe el modelo o parte del nombre...">
        <div class="impuesto-info">
            <strong>‚ÑπÔ∏è Precios finales con 22% de impuesto incluido</strong><br>
            Los precios mostrados ya incluyen todos los impuestos
        </div>
    </div>

    <!-- Acceso admin (solo muestra ENTRAR) -->
    <div class="panel">
        <div class="panel-title">Acceso Administrador</div>
        <button id="btnLogin" class="btn-admin">üîê Entrar</button>
        <button id="btnLogout" class="btn-logout">üëã Salir</button>
    </div>

</div>

<!-- CAT√ÅLOGO -->
<div class="catalogo-wrapper">
    <div id="catalogo" class="catalogo"></div>
    <div id="mensajeVacio" style="display:none;">No se encontraron productos.</div>
</div>

<!-- Sin espacios en la URL -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
// =========================
// CONFIG PRIVADA DEL C√ìDIGO
// =========================
const ADMIN_USER = "TELEFONO";
const ADMIN_PASS = "1234"; // contrase√±a
const SHEET_ID = "1EtOwxNRGq0WFgGaRXtJgibUqzxIgcAUeRkJlr1wPsLc";
const IMPUESTO = 1.22; // 22% de impuesto

let esAdmin = false;
let productos = [];
// Sin espacios en la URL
const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;

function formatearPrecio(num){
    return "$" + num.toLocaleString("es-DO");
}

function cargarLista(data){
    productos = [];

    data.forEach(fila=>{
        const desc = (fila[2]||"").trim();
        const precioRaw = (fila[3]||"").trim();
        if (!desc || !precioRaw) return;

        let esTransito = false;
        let base = null;

        if (precioRaw.toUpperCase().includes("TRANSITO")) {
            esTransito = true;
        } else {
            let soloNum = precioRaw.replace(/[^0-9]/g,"");
            base = parseFloat(soloNum) || null;
        }

        productos.push({
            descripcion: desc,
            basePrecio: base,
            esTransito
        });
    });
}

function renderProductos(filtro=""){
    const cont = document.getElementById("catalogo");
    const vacio = document.getElementById("mensajeVacio");

    cont.innerHTML = "";
    const f = filtro.trim().toLowerCase();

    const lista = productos.filter(p=>!f || p.descripcion.toLowerCase().includes(f));

    vacio.style.display = lista.length === 0 ? "block" : "none";

    lista.forEach((p,idx)=>{
        let final = "";
        let clase = "";

        if(p.esTransito){
            final = "TR√ÅNSITO";
            clase = "transito";
        } else if(p.basePrecio){
            // Aplicar 22% de impuesto (multiplicar por 1.22) y redondear
            const precioConImpuesto = Math.round(p.basePrecio * IMPUESTO);
            final = formatearPrecio(precioConImpuesto);
        } else {
            final = "SIN PRECIO";
            clase = "transito";
        }

        const card = document.createElement("div");
        card.className = "producto";

        // EDITOR SOLO SI ADMIN (no muestra precio base al p√∫blico)
        const editor = esAdmin && !p.esTransito ? `
            <div class="editor-precio">
                <input type="number" value="${p.basePrecio||""}" min="0" data-idx="${idx}" class="input-precio" placeholder="Precio base">
                <button data-idx="${idx}" class="btn-aplicar">‚úÖ Aplicar</button>
            </div>
            <div class="precio-final">*Precio final con impuestos</div>
        ` : "";

        card.innerHTML = `
            <div class="descripcion">${p.descripcion}</div>
            <div class="producto-right">
                <div class="precio ${clase}">${final}</div>
                ${editor}
            </div>
        `;

        cont.appendChild(card);
    });
}

async function cargarCatalogo(){
    try {
        const resp = await fetch(CSV_URL);
        if (!resp.ok) throw new Error(`Error al cargar el cat√°logo: ${resp.status}`);
        const csv = await resp.text();
        Papa.parse(csv,{
            header:false,
            skipEmptyLines:true,
            complete:(res)=>{
                cargarLista(res.data);
                renderProductos();
            },
            error: (err) => {
                console.error("Error parsing CSV:", err);
                document.getElementById("mensajeVacio").textContent = "‚ùå Error al cargar el cat√°logo. Verifica tu conexi√≥n.";
                document.getElementById("mensajeVacio").style.display = "block";
            }
        });
    } catch (error) {
        console.error("Error fetching catalog:", error);
        document.getElementById("mensajeVacio").textContent = `‚ùå Error: ${error.message}`;
        document.getElementById("mensajeVacio").style.display = "block";
    }
}

// Buscar
document.getElementById("buscadorProductos").addEventListener("input", e=>{
    renderProductos(e.target.value);
});

// Login
document.getElementById("btnLogin").addEventListener("click", ()=>{
    const u = prompt("Usuario:");
    if(!u) return;
    const p = prompt("Contrase√±a:");

    if(u===ADMIN_USER && p===ADMIN_PASS){
        esAdmin = true;
        document.getElementById("btnLogout").style.display="inline-block";
        document.getElementById("btnLogin").style.display="none";
        alert("‚úÖ Modo administrador activado\n\nPuedes editar los precios base de los productos.\n*Los clientes solo ven el precio final con impuestos.");
        renderProductos(document.getElementById("buscadorProductos").value);
    } else {
        alert("‚ùå Acceso denegado\n\nUsuario o contrase√±a incorrectos");
    }
});

// Logout
document.getElementById("btnLogout").addEventListener("click", ()=>{
    esAdmin = false;
    document.getElementById("btnLogout").style.display="none";
    document.getElementById("btnLogin").style.display="inline-block";
    alert("‚úÖ Sesi√≥n cerrada");
    renderProductos(document.getElementById("buscadorProductos").value);
});

// Guardar precio
document.getElementById("catalogo").addEventListener("click", e=>{
    if(e.target.classList.contains("btn-aplicar")){
        const idx = e.target.dataset.idx;
        const input = document.querySelector(`.input-precio[data-idx="${idx}"]`);
        const val = parseFloat(input.value);
        if(!val || val <= 0){ 
            alert("‚ùå Precio inv√°lido. Debe ser un n√∫mero mayor a 0.");
            return;
        }
        productos[idx].basePrecio = val;
        // Mostrar confirmaci√≥n visual
        e.target.textContent = "‚úÖ Guardado";
        e.target.style.background = "linear-gradient(135deg, var(--success), #00aa30)";
        setTimeout(() => {
            e.target.textContent = "‚úÖ Aplicar";
            e.target.style.background = "";
        }, 1500);
        renderProductos(document.getElementById("buscadorProductos").value);
    }
});

// Cargar cat√°logo al iniciar
window.addEventListener("DOMContentLoaded", cargarCatalogo);
</script>

</body>
</html>

