<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Trifusion Technologies ‚Äî Cat√°logo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
    margin:0;
    font-family:system-ui, Arial, sans-serif;
    background:#0b0f19;
    color:#e6ecff;
}
header{
    padding:18px;
    background:#000;
}
.catalogo{
    max-width:1100px;
    margin:30px auto;
    padding:0 16px;
}
.categoria{
    margin:28px 0 16px;
    padding:14px 18px;
    background:rgba(0,194,255,.22);
    border-left:6px solid #00c2ff;
    font-weight:800;
    letter-spacing:.15em;
    text-transform:uppercase;
}
.producto{
    background:#101624;
    border:1px solid #1f2940;
    border-radius:12px;
    padding:14px;
    margin-bottom:10px;
    display:flex;
    justify-content:space-between;
    gap:12px;
}
.descripcion{
    color:#00c2ff;
    font-weight:600;
}
.precio{
    color:#ff4b6a;
    font-weight:700;
    white-space:nowrap;
}
</style>
</head>

<body>

<header>
    <h1>Trifusion Technologies</h1>
</header>

<div id="catalogo" class="catalogo"></div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
const SHEET_ID = "1EtOwxNRGq0WFgGaRXtJgibUqzxIgcAUeRkJlr1wPsLc";
const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;
const cont = document.getElementById("catalogo");

function tienePrecioNumerico(txt){
    return /\d/.test(txt);
}

function formatearPrecio(n){
    return "$" + Number(n).toLocaleString("es-DO");
}

fetch(CSV_URL)
.then(r=>r.text())
.then(csv=>{
    Papa.parse(csv,{
        skipEmptyLines:true,
        complete:(res)=>{
            const rows = res.data;
            cont.innerHTML = "";

            rows.forEach((row, i)=>{
                const modelo = (row[2]||"").trim();
                const precio = (row[3]||"").trim();

                if(!modelo) return;

                const siguiente = rows[i+1] || [];
                const nextModelo = (siguiente[2]||"").trim();
                const nextPrecio = (siguiente[3]||"").trim();

                const siguienteEsProducto =
                    nextModelo &&
                    (tienePrecioNumerico(nextPrecio) || nextPrecio.toUpperCase().includes("TRANSITO"));

                // üîµ CATEGOR√çA CONTEXTUAL
                if(!precio && siguienteEsProducto){
                    const cat = document.createElement("div");
                    cat.className = "categoria";
                    cat.textContent = modelo;
                    cont.appendChild(cat);
                    return;
                }

                // üö´ TRANSITO NO SE MUESTRA
                if(precio.toUpperCase().includes("TRANSITO")) return;

                // üü¢ PRODUCTO CON PRECIO
                if(tienePrecioNumerico(precio)){
                    const num = precio.replace(/[^0-9]/g,"");
                    const prod = document.createElement("div");
                    prod.className = "producto";
                    prod.innerHTML = `
                        <div class="descripcion">${modelo}</div>
                        <div class="precio">${formatearPrecio(num)}</div>
                    `;
                    cont.appendChild(prod);
                }
            });
        }
    });
});
</script>

</body>
</html>
