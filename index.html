<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Trifusion Technologies ‚Äî Cat√°logo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- üî¥ FIX CLAVE PARA GOOGLE DRIVE -->
    <meta name="referrer" content="no-referrer">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', system-ui, Arial, sans-serif;
            background: linear-gradient(135deg, #0a0e17, #1a1f2e);
            color: #e6ecff;
        }

        header {
            padding: 20px;
            background: rgba(0,0,0,.85);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        header h1 {
            font-size: 1.8rem;
            background: linear-gradient(90deg,#00c2ff,#7b3fe4);
            -webkit-background-clip: text;
            color: transparent;
        }

        .btn {
            padding: 10px 18px;
            border-radius: 10px;
            border: none;
            font-weight: 700;
            cursor: pointer;
        }

        .btn-admin { background: #ff8a00; color: #fff; }
        .btn-logout { background: #ff4b6a; color: #fff; display:none }

        .catalogo {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .categoria {
            margin: 30px 0 15px;
            padding: 15px;
            background: rgba(0,30,60,.7);
            border-left: 5px solid #00c2ff;
            font-weight: 800;
            text-transform: uppercase;
        }

        .producto {
            background: rgba(16,22,36,.85);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .descripcion {
            font-size: 1.2rem;
            color: #4da6ff;
            font-weight: 700;
        }

        .precio {
            font-size: 1.4rem;
            font-weight: 800;
            color: #ff4b6a;
        }

        .producto-img {
            width: 200px;
            max-height: 200px;
            object-fit: contain;
            background: #050814;
            border-radius: 12px;
            cursor: pointer;
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }

        .modal.active { display: flex; }

        .modal-img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 16px;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #ff4b6a;
            border: none;
            color: white;
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #00c2ff;
            font-size: 1.2rem;
        }
    </style>
</head>

<body>

<header>
    <h1>Trifusion Technologies</h1>
    <div>
        <button id="loginBtn" class="btn btn-admin">üîê Modo Admin</button>
        <button id="logoutBtn" class="btn btn-logout">üëã Salir</button>
    </div>
</header>

<div class="catalogo" id="catalogo">
    <div class="loading">Cargando cat√°logo‚Ä¶</div>
</div>

<!-- MODAL -->
<div id="imageModal" class="modal">
    <button class="close-modal">&times;</button>
    <img id="modalImage"
         class="modal-img"
         src=""
         referrerpolicy="no-referrer">
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<!-- PapaParse -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDlOJqBgd-8KqUT-Y94lsma5W8T79PsPjM",
  authDomain: "trifusion-cotizador.firebaseapp.com",
  projectId: "trifusion-cotizador"
};
firebase.initializeApp(firebaseConfig);

const db = firebase.firestore();
const SHEET_ID = "1EtOwxNRGq0WFgGaRXtJgibUqzxIgcAUeRkJlr1wPsLc";
const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;

const cont = document.getElementById("catalogo");
const modal = document.getElementById("imageModal");
const modalImage = document.getElementById("modalImage");

function limpiar(txt) {
  return txt.replace(/[\u{1F300}-\u{1FAFF}]/gu,"").trim();
}

function esCategoria(row) {
  return row.filter(c => c && c.trim()).length === 1;
}

function precio(p) {
  return "$" + Number(p.replace(/\D/g,"")).toLocaleString("es-DO");
}

fetch(CSV_URL)
  .then(r => r.text())
  .then(csv => {
    const data = Papa.parse(csv,{skipEmptyLines:true}).data;
    cont.innerHTML = "";

    data.forEach(row => {
      if (esCategoria(row)) {
        const cat = document.createElement("div");
        cat.className = "categoria";
        cat.textContent = limpiar(row.find(c=>c));
        cont.appendChild(cat);
        return;
      }

      const nombre = limpiar(row[2]||"");
      const price = row[3]||"";
      if (!nombre || !price) return;

      const prod = document.createElement("div");
      prod.className = "producto";

      prod.innerHTML = `
        <div style="flex:1">
          <div class="descripcion">${nombre}</div>
          <div class="precio">${precio(price)}</div>
        </div>
        <img class="producto-img"
             src="https://drive.google.com/uc?export=view&id=10cfAV5CR5PmoudLV6_b_vHGsXUsWoR_r"
             referrerpolicy="no-referrer">
      `;

      const img = prod.querySelector("img");
      img.onclick = () => {
        modalImage.src = img.src;
        modal.classList.add("active");
      };

      cont.appendChild(prod);
    });
  });

document.querySelector(".close-modal").onclick = () => {
  modal.classList.remove("active");
};
modal.onclick = e => {
  if (e.target === modal) modal.classList.remove("active");
};
</script>

</body>
</html>
